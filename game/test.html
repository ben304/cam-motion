<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Test</title>
		<style>
		</style>
	</head>
	<body>
		<div>
			<video autoplay width="320" height="240"></video>
		</div>
		<canvas id="c1" width="320" height="240" style="display:none;"></canvas>
		<canvas id="c2" width="320" height="240"></canvas>
		<canvas id="c3" width="320" height="240"></canvas>
		<canvas id="c4" width="320" height="240"></canvas>

		<script src="tools/ps.js"></script>
		<script>
			window.URL = window.URL || window.webkitURL;
			navigator.getUerMedia = navigator.getUerMedia
				|| navigator.webkitGetUserMedia
				|| navigator.mozGetUserMedia
				|| navigator.msGetUserMedia;

			var video = document.querySelector("video"),
				c1 = document.querySelector("#c1"),
				c2 = document.querySelector("#c2"),
				c3 = document.querySelector("#c3"),
				c4 = document.querySelector("#c4"),
				ctx1 = c1.getContext("2d"),
				ctx2 = c2.getContext("2d"),
				ctx3 = c3.getContext("2d"),
				ctx4 = c4.getContext("2d"),
				localMediaStream,
				first = true,
				last,
				bg;

			if (navigator.getUerMedia) {
				navigator.getUerMedia({video: true}, function(stream) {

					video.src = window.URL.createObjectURL(stream);
					localMediaStream = stream;

					setInterval(function() {
						ctx1.drawImage(video, 0, 0, 160, 120);
						var cur = ctx1.getImageData(0, 0, 160, 120);
						var newCanvas1 = ctx2.createImageData(160, 120),
							newCanvas2 = ctx2.createImageData(160, 120);
						// background
						if (first) {
							last = bg = cur;
							ctx2.putImageData(cur, 0, 0);
							first = false;
						} else {
							Filters.differenceAccuracy(newCanvas1.data, cur.data, bg.data);
							ctx3.putImageData(newCanvas1, 0, 0);

							Filters.differenceAccuracy(newCanvas2.data, cur.data, last.data);
							ctx4.putImageData(newCanvas2, 0, 0);

							last = cur;
						}

					}, 30);
				}, function() {console.log("fail");});
			}
		</script>
	</body>
</html>